(()=>{function g(t,e,o){return $("<table>",{class:e,id:o}).appendTo(t)}function h(t){return $("<tr>").appendTo(t)}function d(t,e,o){var n=$("<td>",{class:e,id:o});return n.appendTo(t),n}function S(t,e,o,n,a){let r=[];for(let l=0;l<2;l++){let i=h(t),s=h(t);d(i,"empty-td",null),d(s,"description-td",null).text("\u9673\u5217\u4F4D");let c=n+l*a,p=e.slice(c,c+a),{storeCells:u,imageCells:F}=X(p,o,i,s);if(R(i,s,a-p.length),r.push({storeCells:u,imageCells:F.filter(I=>I!==null)}),e.length<=c+a)break}return r}function k(t,e,o){let n=$("<img>").addClass("place-pic").attr("store",o).attr("src","data:image/png;base64,"+e).css({width:"100%",height:"100%"});t.empty().append(n)}function X(t,e,o,n){let a=[],r=[];return t.forEach(l=>{let i=e.get(l.rowId)||null,s=`store-${l.rowId}`,c=`photo-${l.rowId}`,p=d(o,"store-td",s).text(l.store);if(a.push(p),i){let u=d(n,"photo-td",c);k(u,i,l.store),r.push(u)}else{let u=d(n,"photo-td",c).text("\u7121\u5716\u50CF");r.push(u)}}),{storeCells:a,imageCells:r}}function R(t,e,o){for(let n=0;n<o;n++)d(t,"store-td",null).text("\u7121\u8CC7\u6599"),d(e,"photo-td",null).text("\u7121\u5716\u50CF")}function w(t,e){let o=t[0];return Array.from({length:Math.ceil((t.length-1)/e)},(n,a)=>[o,...t.slice(a*e+1,a*e+1+e)])}function y(t,e){let o=new Map,n=new Set;return e.getImages().forEach(a=>{let r=t.model.media.find(i=>i.index===a.imageId),l=a.range.tl.nativeRow+1;n.has(l)||(n.add(l),o.set(l,r.buffer.toString("base64")))}),o}function b(t){let e=[],o=[];return t.eachRow({includeEmpty:!0},(n,a)=>{let r=[4,7,8].map(l=>n.getCell(l).value||null);r.every(l=>l)&&(e.push(r.map((l,i)=>({text:l,options:{fill:i===0?"99cdff":"b5c7dd"}}))),o.push({rowId:a,store:r[0]}))}),{displayData:e,storeData:o}}function m(t){let e=0,o=1;return t.eachRow({includeEmpty:!0},n=>{[4,7,8].map(r=>n.getCell(r).value||null).every(r=>r)&&e++}),e-o}var f=new PptxGenJS;function A(t){w(t,10).forEach(n=>{console.log(n),f.addSlide().addTable(n,{align:"left",valign:"middle",fontSize:18,colW:[2.2,5.2,1.7],rowH:.35,border:{pt:"1",color:"FFFFFF"}})})}async function L(){let t=Array.from(document.querySelectorAll(".place-pic")),e;for(let o=0;o<t.length;o+=5){e=f.addSlide();let n=9/5,a=[Array(5).fill(null).map((r,l)=>({text:t[o+l]?.getAttribute("store")||"",options:{fill:"FFFFFF",border:[{type:"solid",color:"000000",pt:1},{type:"solid",color:"000000",pt:1},{type:"solid",color:"000000",pt:1},{type:"solid",color:"000000",pt:1}],align:"center",color:"000000",fontSize:18,margin:[.05,.1,.05,.1],valign:"middle"}}))];e.addTable(a,{x:.5,y:.5,w:9,h:1,colW:Array(5).fill(n)});for(let r=0;r<5;r++)if(t[o+r])try{let l=await domtoimage.toPng(t[o+r]);e.addImage({data:l,w:n,h:3,x:.5+r*n,y:1.6})}catch(l){console.error("Error processing image:",l)}}}var x=0;function E(t,e,o,n=6){o.shift();let a=y(t,e),r=[];for(let l=0;l<o.length;l+=n*2){let i=`${e.name}-photo-table-${x}`;x++;let s=g($("#pptTableContainer"),"photo-table",i),c=S(s,o,a,l,n);r.push({id:i,rows:c,rowCount:c.length,columnCount:n})}return{tables:r}}function z(){f.addSlide().addText([{text:"\u5357\u50D1\u6C34\u6676",options:{fontFace:"\u6A19\u6977\u9AD4",fontSize:54,color:"000000",breakLine:!0,align:"center",valign:"middle"}},{fontFace:"\u6A19\u6977\u9AD4",text:`PX113${(new Date().getMonth()+1).toString().padStart(2,"0")}`,options:{fontSize:60,color:"000000",breakLine:!0,align:"center",valign:"middle"}},{fontFace:"\u6A19\u6977\u9AD4",text:"DM\u5546\u54C1\u7B2C\u4E8C\u9673\u5217",options:{fontSize:60,color:"000000",align:"center",valign:"middle"}}],{h:"100%",w:"100%"})}function M(t){let e=[],o={fontFace:"\u6A19\u6977\u9AD4",fontSize:32,color:"000000",breakLine:!0,align:"center",valign:"middle"},n=0;return t.eachSheet(a=>{n+=m(a),e.push({text:`${a.name}\u7B2C\u4E8C\u9673\u5217\u5E97\u5BB6-\u5171${m(a)}\u5BB6`,options:o})}),e.push({text:`\u76EE\u524D\u9673\u5217${n}\u5BB6(\u6301\u7E8C\u66F4\u65B0\u4E2D)`,options:o}),e}function B(t){f.addSlide().addText(t,{h:"100%",w:"100%"})}async function N(t,e,o,n){e.length>1?A(e):console.log("\u7121\u9673\u5217\u5E97\u5BB6\u8CC7\u6599"),t.length>1&&E(o,n,t)}async function Q(t){let e=[];t.eachSheet(o=>{let n=b(o);e.push(N(n.storeData,n.displayData,t,o))}),await Promise.all(e)}function V(){f.writeFile({fileName:`PX${new Date().getFullYear()-1911}\u5E74${new Date().getMonth()+1}\u6708\u4EFD\u9673\u5217\u7167\u7247.pptx`}),Swal.fire({title:"\u5DF2\u6210\u529F\u8F49\u63DB\u4E0B\u8F09PPT",icon:"success"})}async function C(t){z(),B(M(t)),await Q(t),await L(),V()}function P(t,e){let o={...t,...e};return Object.keys(o).map(n=>`${n}: ${o[n]};`).join(" ")}function v({id:t,text:e,styles:o}){let n=P([],o);return`
          <div class="file-input">
              <input type="file" name="${t}" id="${t}" class="file-input-input">
              <label class="file-input-label" for="${t}" style="${n}">
                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="upload" class="svg-inline--fa fa-upload fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="currentColor" d="M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path>
                    </svg>
                  <span>${e}</span>
              </label>
          </div>
      `}function T(t){return t&&t.name.split(".").pop().toLowerCase()==="xlsx"}function D(t){return T(t)?!0:(Swal.fire({title:"\u4E0D\u652F\u63F4\u7684\u6A94\u6848\u985E\u578B\uFF0C\u5FC5\u9808\u662F XLSX \u6A94!",icon:"error"}),!1)}$(document).ready(function(){function t(){$(".top-row").append(v({id:"xlsx2ppt",text:"PPT",styles:{background:"#d04424"}}))}t(),$("#xlsx2ppt").on("change",function(){var e=this.files[0];if(!D(e)){$(this).val("");return}Pace.restart();let o=new FileReader;o.onloadend=async function(){let n=new ExcelJS.Workbook;await n.xlsx.load(o.result),C(n),Pace.stop()},o.readAsArrayBuffer(e)})});})();
