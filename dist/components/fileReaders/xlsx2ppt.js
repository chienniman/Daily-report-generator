(()=>{function g(e,t,n){return $("<table>",{class:t,id:n}).appendTo(e)}function h(e){return $("<tr>").appendTo(e)}function u(e,t,n){var o=$("<td>",{class:t,id:n});return o.appendTo(e),o}function w(e,t,n,o,r){let a=[];for(let l=0;l<2;l++){let i=h(e),c=h(e);u(i,"empty-td",null),u(c,"description-td",null).text("\u9673\u5217\u4F4D");let s=o+l*r,d=t.slice(s,s+r),{storeCells:f,imageCells:D}=E(d,n,i,c);if(F(i,c,r-d.length),a.push({storeCells:f,imageCells:D.filter(I=>I!==null)}),t.length<=s+r)break}return a}function X(e,t){let n=$("<img>").attr("src","data:image/png;base64,"+t).css({width:"100%",height:"100%"});e.empty().append(n)}function E(e,t,n,o){let r=[],a=[];return e.forEach(l=>{let i=t.get(l.rowId)||null,c=`store-${l.rowId}`,s=`photo-${l.rowId}`,d=u(n,"store-td",c).text(l.store);if(r.push(d),i){let f=u(o,"photo-td",s);X(f,i),a.push(f)}else{let f=u(o,"photo-td",s).text("\u7121\u5716\u50CF");a.push(f)}}),{storeCells:r,imageCells:a}}function F(e,t,n){for(let o=0;o<n;o++)u(e,"store-td",null).text("\u7121\u8CC7\u6599"),u(t,"photo-td",null).text("\u7121\u5716\u50CF")}function S(e,t){let n=e[0];return Array.from({length:Math.ceil((e.length-1)/t)},(o,r)=>[n,...e.slice(r*t+1,r*t+1+t)])}function b(e,t){let n=new Map,o=new Set;return t.getImages().forEach(r=>{let a=e.model.media.find(i=>i.index===r.imageId),l=r.range.tl.nativeRow+1;o.has(l)||(o.add(l),n.set(l,a.buffer.toString("base64")))}),n}function x(e){let t=[],n=[];return e.eachRow({includeEmpty:!0},(o,r)=>{let a=[4,7,8].map(l=>o.getCell(l).value||null);a.every(l=>l)&&(t.push(a.map((l,i)=>({text:l,options:{fill:i===0?"99cdff":"b5c7dd"}}))),n.push({rowId:r,store:a[0]}))}),{displayData:t,storeData:n}}function m(e){let t=0,n=1;return e.eachRow({includeEmpty:!0},o=>{[4,7,8].map(a=>o.getCell(a).value||null).every(a=>a)&&t++}),t-n}var p=new PptxGenJS;function L(e){S(e,10).forEach(o=>{p.addSlide().addTable(o,{align:"left",valign:"middle",fontSize:18,colW:[2.2,5.2,1.7],rowH:.35,border:{pt:"1",color:"FFFFFF"}})})}function R(e){let t=[];e.tables.forEach((n,o)=>{let r=document.getElementById(n.id);if(!r){console.error(`Table-id ${n.id} empty.`);return}let a=n.rows.length<2?"50%":"100%",l=domtoimage.toPng(r).then(i=>{p.addSlide().addImage({data:i,w:"100%",h:a})}).catch(i=>{console.error(`Error table-id ${n.id}:`,i)});t.push(l)}),Promise.all(t).then(()=>{p.writeFile({fileName:`PX${new Date().getFullYear()-1911}\u5E74${new Date().getMonth()+1}\u6708\u4EFD\u9673\u5217\u7167\u7247.pptx`})})}var y=0;function M(e,t,n,o=6){n.shift();let r=b(e,t),a=0,l=[];for(let i=0;i<n.length;i+=o*2){let c=`${t.name}-photo-table-${y}`;y++;let s=g($("#pptTableContainer"),"photo-table",c),d=w(s,n,r,i,o);if(l.push({id:c,rows:d,rowCount:d.length,columnCount:o}),a++,a===2)break}return{tableCount:a,tables:l}}function z(){p.addSlide().addText([{text:"\u5357\u50D1\u6C34\u6676",options:{fontFace:"\u6A19\u6977\u9AD4",fontSize:54,color:"000000",breakLine:!0,align:"center",valign:"middle"}},{fontFace:"\u6A19\u6977\u9AD4",text:`PX113${(new Date().getMonth()+1).toString().padStart(2,"0")}`,options:{fontSize:60,color:"000000",breakLine:!0,align:"center",valign:"middle"}},{fontFace:"\u6A19\u6977\u9AD4",text:"DM\u5546\u54C1\u7B2C\u4E8C\u9673\u5217",options:{fontSize:60,color:"000000",align:"center",valign:"middle"}}],{h:"100%",w:"100%"})}function A(e){let t=[],n={fontFace:"\u6A19\u6977\u9AD4",fontSize:32,color:"000000",breakLine:!0,align:"center",valign:"middle"},o=0;return e.eachSheet(r=>{o+=m(r),t.push({text:`${r.name}\u7B2C\u4E8C\u9673\u5217\u5E97\u5BB6-\u5171${m(r)}\u5BB6`,options:n})}),t.push({text:`\u76EE\u524D\u9673\u5217${o}\u5BB6(\u6301\u7E8C\u66F4\u65B0\u4E2D)`,options:n}),t}function B(e){p.addSlide().addText(e,{h:"100%",w:"100%"})}function N(e,t,n,o){t.length>1?L(t):console.log("\u7121\u9673\u5217\u5E97\u5BB6\u8CC7\u6599"),e.length>1?R(M(n,o,e)):console.log("\u7121\u9673\u5217\u7167\u7247")}function V(e){e.eachSheet(t=>{let n=x(t);N(n.storeData,n.displayData,e,t)})}function C(e){z(),B(A(e)),V(e),Swal.fire({title:"\u5DF2\u8F49\u63DB\u6210PPT\u6A94",icon:"success"})}function v(e,t){let n={...e,...t};return Object.keys(n).map(o=>`${o}: ${n[o]};`).join(" ")}function P({id:e,text:t,styles:n}){let o=v([],n);return`
          <div class="file-input">
              <input type="file" name="${e}" id="${e}" class="file-input-input">
              <label class="file-input-label" for="${e}" style="${o}">
                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="upload" class="svg-inline--fa fa-upload fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="currentColor" d="M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path>
                    </svg>
                  <span>${t}</span>
              </label>
          </div>
      `}function T(e){return e&&e.name.split(".").pop().toLowerCase()==="xlsx"}function k(e){return T(e)?!0:(Swal.fire({title:"\u4E0D\u652F\u63F4\u7684\u6A94\u6848\u985E\u578B\uFF0C\u5FC5\u9808\u662F XLSX \u6A94!",icon:"error"}),!1)}$(document).ready(function(){function e(){$(".top-row").append(P({id:"xlsx2ppt",text:"PPT",styles:{background:"#d04424"}}))}e(),$("#xlsx2ppt").on("change",function(){var t=this.files[0];if(!k(t)){$(this).val("");return}Pace.restart();let n=new FileReader;n.onloadend=async function(){let o=new ExcelJS.Workbook;await o.xlsx.load(n.result),C(o),Pace.stop()},n.readAsArrayBuffer(t)})});})();
