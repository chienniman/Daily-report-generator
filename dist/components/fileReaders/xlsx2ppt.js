(()=>{function g(t,e,n){return $("<table>",{class:e,id:n}).appendTo(t)}function h(t){return $("<tr>").appendTo(t)}function d(t,e,n){var o=$("<td>",{class:e,id:n});return o.appendTo(t),o}function w(t,e,n,o,l){let s=[];for(let a=0;a<2;a++){let c=h(t),r=h(t);d(c,"empty-td",null),d(r,"description-td",null).text("\u9673\u5217\u4F4D");let i=e.slice(o+a*l,o+(a+1)*l),{storeCells:u,imageCells:p}=D(i,n,c,r);if(E(c,r,l-i.length),s.push({storeCells:u,imageCells:p.filter(P=>P!==null)}),e.length<=o+(a+1)*l)break}return s}function T(t,e){let n=$("<img>").attr("src","data:image/png;base64,"+e).css({width:"100%",height:"100%"});t.empty().append(n)}function D(t,e,n,o){let l=[],s=[];return t.forEach(a=>{let c=e.get(a.rowId)||null,r=`store-${a.rowId}`,i=`photo-${a.rowId}`,u=d(n,"store-td",r).text(a.store);if(l.push(u),c){let p=d(o,"photo-td",i);T(p,c),s.push(p)}else{let p=d(o,"photo-td",i).text("\u7121\u5716\u50CF");s.push(p)}}),{storeCells:l,imageCells:s}}function E(t,e,n){for(let o=0;o<n;o++)d(t,"store-td",null).text("\u7121\u8CC7\u6599"),d(e,"photo-td",null).text("\u7121\u5716\u50CF")}function b(t,e){let n=t[0];return Array.from({length:Math.ceil((t.length-1)/e)},(o,l)=>[n,...t.slice(l*e+1,l*e+1+e)])}function y(t,e){let n=new Map,o=new Set;return e.getImages().forEach(l=>{let s=t.model.media.find(c=>c.index===l.imageId),a=l.range.tl.nativeRow+1;o.has(a)||(o.add(a),n.set(a,s.buffer.toString("base64")))}),n}function x(t){let e=[],n=[];return t.eachRow({includeEmpty:!0},(o,l)=>{let s=[4,7,8].map(a=>o.getCell(a).value||null);s.every(a=>a)&&(e.push(s.map((a,c)=>({text:a,options:{fill:c===0?"99cdff":"b5c7dd"}}))),n.push({rowId:l,store:s[0]}))}),{displayData:e,storeData:n}}function m(t){let e=0,n=1;return t.eachRow({includeEmpty:!0},o=>{[4,7,8].map(s=>o.getCell(s).value||null).every(s=>s)&&e++}),e-n}var f=new PptxGenJS;function F(t){b(t,10).forEach(o=>{f.addSlide().addTable(o,{align:"left",valign:"middle",fontSize:18,colW:[2.2,5.2,1.7],rowH:.35,border:{pt:"1",color:"FFFFFF"}})})}function I(t){let e=[];t.tables.forEach((n,o)=>{let l=document.getElementById(n.id);if(!l){console.error(`Table-id ${n.id} empty.`);return}let s=n.rows.length<2?"50%":"100%",a=domtoimage.toPng(l).then(c=>{f.addSlide().addImage({data:c,w:"100%",h:s})}).catch(c=>{console.error(`Error table-id ${n.id}:`,c)});e.push(a)}),Promise.all(e).then(()=>{f.writeFile({fileName:`PX${new Date().getFullYear()-1911}\u5E74${new Date().getMonth()+1}\u6708\u4EFD\u9673\u5217\u7167\u7247.pptx`})})}function R(t,e,n,o=6){n.shift();let l=y(t,e),s=0,a=[];for(let c=0;c<n.length;c+=o*2){let r=`photo-table-${s}`,i=g($("#pptTableContainer"),"photo-table",r),u=w(i,n,l,c,o);if(a.push({id:r,rows:u,rowCount:u.length,columnCount:o}),s++,s===2)break}return{tableCount:s,tables:a}}function k(){f.addSlide().addText([{text:"\u5357\u50D1\u6C34\u6676",options:{fontFace:"\u6A19\u6977\u9AD4",fontSize:54,color:"000000",breakLine:!0,align:"center",valign:"middle"}},{fontFace:"\u6A19\u6977\u9AD4",text:`PX113${(new Date().getMonth()+1).toString().padStart(2,"0")}`,options:{fontSize:60,color:"000000",breakLine:!0,align:"center",valign:"middle"}},{fontFace:"\u6A19\u6977\u9AD4",text:"DM\u5546\u54C1\u7B2C\u4E8C\u9673\u5217",options:{fontSize:60,color:"000000",align:"center",valign:"middle"}}],{h:"100%",w:"100%"})}function z(t){let e=[],n={fontFace:"\u6A19\u6977\u9AD4",fontSize:32,color:"000000",breakLine:!0,align:"center",valign:"middle"},o=0;return t.eachSheet(l=>{o+=m(l),e.push({text:`${l.name}\u7B2C\u4E8C\u9673\u5217\u5E97\u5BB6-\u5171${m(l)}\u5BB6`,options:n})}),e.push({text:`\u76EE\u524D\u9673\u5217${o}\u5BB6(\u6301\u7E8C\u66F4\u65B0\u4E2D)`,options:n}),e}function A(t){f.addSlide().addText(t,{h:"100%",w:"100%"})}function B(t,e,n,o){e.length>1?F(e):console.log("\u7121\u9673\u5217\u5E97\u5BB6\u8CC7\u6599"),t.length>1?I(R(n,o,t)):console.log("\u7121\u9673\u5217\u7167\u7247")}function M(t){t.eachSheet(e=>{let n=x(e);B(n.storeData,n.displayData,t,e)})}function S(t){k(),A(z(t)),M(t),Swal.fire({title:"\u5DF2\u8F49\u63DB\u6210PPT\u6A94",icon:"success"})}function C(t,e){let n={...t,...e};return Object.keys(n).map(o=>`${o}: ${n[o]};`).join(" ")}function v({id:t,text:e,styles:n}){let o=C([],n);return`
          <div class="file-input">
              <input type="file" name="${t}" id="${t}" class="file-input-input">
              <label class="file-input-label" for="${t}" style="${o}">
                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="upload" class="svg-inline--fa fa-upload fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path fill="currentColor" d="M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path>
                    </svg>
                  <span>${e}</span>
              </label>
          </div>
      `}$(document).ready(function(){function t(){$(".top-row").append(v({id:"xlsx2ppt",text:"PPT",styles:{background:"#d04424"}}))}t(),$("#xlsx2ppt").on("change",function(e){let n=e.target.files[0];if(!n)return;Pace.restart();let o=new FileReader;o.onloadend=async function(){let l=new ExcelJS.Workbook;await l.xlsx.load(o.result),S(l),Pace.stop()},o.readAsArrayBuffer(n)})});})();
